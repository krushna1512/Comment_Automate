name: 'without'

on:
  workflow_dispatch:

jobs:
  check_inactive_issues:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Get issues
        id: get-issues
        run: echo "::set-output name=data::$(curl -s -H \"Authorization: Bearer ${{ secrets.TOKEN }}\" \
          -H \"Accept: application/vnd.github.v3+json\" \
          https://api.github.com/repos/${{ github.repository }}/issues?state=open)"

      - name: Add comment to inactive issues
        uses: actions/github-script@v4
        with:
          script: |
            const issues = JSON.parse(${{ steps.get-issues.outputs.data }});
            const fourDaysAgo = new Date();
            fourDaysAgo.setDate(fourDaysAgo.getDate() - 4);

            for (const issue of issues) {
              const lastActivityDate = new Date(issue.updated_at);
              if (lastActivityDate < fourDaysAgo && issue.comments === 0) {
                const body = {
                  issue_number: issue.number,
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  body: "It seems there has been no activity on this issue for the past four days. If you still require assistance, please let us know."
                };

                github.issues.createComment(body);
              }
            }

